<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Work Timer — prosty</title>
<style>
  :root{
    --card-bg: #efefef;      /* neutralne szarości */
    --card-border: #dedede;
    --text: #222;
    --muted: #666;
    --accent: #2b2b2b;
    --btn-bg: #fff;
    --btn-border: #d0d0d0;
    --success: #2b2b2b;
  }

  /* reset + layout */
  html,body{height:100%;margin:0;background:transparent;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:16px;box-sizing:border-box}

  /* karta */
  .card{
    width:100%;max-width:320px;
    background:var(--card-bg);
    border:1px solid var(--card-border);
    border-radius:12px;
    padding:14px;
    box-sizing:border-box;
    color:var(--text);
    display:flex;flex-direction:column;gap:10px;
  }

  /* prosty nagłówek */
  .title{margin:0;font-size:0.95rem;font-weight:700;color:var(--accent);text-align:center}

  /* input */
  .row{display:flex;gap:8px}
  input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid var(--btn-border);background:#fff;font-size:0.95rem}

  /* timer (monospace) */
  #timerDisplay{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Roboto Mono,monospace;font-size:2rem;text-align:center;color:var(--accent);margin:4px 0}

  /* controls - proste przyciski */
  .controls{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
  .controls button{
    background:var(--btn-bg);
    border:1px solid var(--btn-border);
    padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer;
    min-width:72px;
  }
  .controls button.primary{background:var(--success);color:#fff;border:none}
  .controls button:disabled{opacity:0.5;cursor:not-allowed}

  /* meta / log */
  .meta{display:flex;justify-content:space-between;font-size:0.9rem;color:var(--muted)}
  .log{max-height:160px;overflow:auto;border-top:1px solid var(--card-border);padding-top:8px}
  table{width:100%;border-collapse:collapse;font-size:0.9rem}
  th,td{padding:6px 4px;text-align:left;color:var(--muted);border-bottom:1px solid #eee}
  th{font-weight:700;color:var(--accent);font-size:0.85rem}

  /* akcje dolne */
  .actions{display:flex;gap:8px;justify-content:center;margin-top:6px}
  .actions button{padding:7px 10px;border-radius:8px;border:1px solid var(--btn-border);background:var(--btn-bg);cursor:pointer}

  /* responsywność */
  @media (max-width:360px){
    .card{padding:12px}
    #timerDisplay{font-size:1.6rem}
    .controls button{min-width:60px;padding:7px 8px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-label="Prosty timer pracy">
      <h3 class="title">Work Timer</h3>

      <div class="row">
        <input id="taskName" type="text" placeholder="Nazwa zadania (np. Raport)" aria-label="Nazwa zadania">
      </div>

      <div id="timerDisplay" aria-live="polite">00:00:00</div>

      <div class="controls" role="group" aria-label="Kontrolki timera">
        <button id="startBtn" class="primary" type="button">Start</button>
        <button id="pauseBtn" type="button">Pause</button>
        <button id="stopBtn" type="button">Stop</button>
        <button id="resetBtn" type="button">Reset</button>
      </div>

      <div class="meta">
        <div>Status: <strong id="statusText">stopped</strong></div>
        <div>Dziś: <strong id="todaySum">00:00:00</strong></div>
      </div>

      <div class="log" id="logContainer" aria-live="polite">
        <table id="logTable" aria-label="Log sesji">
          <thead><tr><th>Task</th><th>Time</th><th>Date</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="actions">
        <button id="exportBtn" type="button">Export CSV</button>
        <button id="clearBtn" type="button">Clear</button>
      </div>
    </div>
  </div>

<script>
  // prosty timer — logika bez zmian
  const storageKey = 'work_timer_sessions_v1';

  function msToHMS(ms){
    const total = Math.floor(ms/1000);
    const h = Math.floor(total/3600);
    const m = Math.floor((total%3600)/60);
    const s = total%60;
    return [h,m,s].map(n=>String(n).padStart(2,'0')).join(':');
  }
  function todayISO(date=new Date()){
    const y = date.getFullYear();
    const m = String(date.getMonth()+1).padStart(2,'0');
    const d = String(date.getDate()).padStart(2,'0');
    return `${y}-${m}-${d}`;
  }

  // DOM
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const stopBtn = document.getElementById('stopBtn');
  const resetBtn = document.getElementById('resetBtn');
  const timerDisplay = document.getElementById('timerDisplay');
  const statusText = document.getElementById('statusText');
  const taskNameInput = document.getElementById('taskName');
  const logTableBody = document.querySelector('#logTable tbody');
  const todaySumEl = document.getElementById('todaySum');
  const exportBtn = document.getElementById('exportBtn');
  const clearBtn = document.getElementById('clearBtn');

  // state
  let running = false;
  let startTs = null;
  let accMs = 0;
  let tickInterval = null;

  // persistence
  function loadSessions(){ try{ const raw = localStorage.getItem(storageKey); return raw ? JSON.parse(raw) : []; }catch(e){return []} }
  function saveSessions(s){ localStorage.setItem(storageKey, JSON.stringify(s)); }

  // render
  function renderTimerDisplay(){
    const elapsed = accMs + (running && startTs ? Date.now()-startTs : 0);
    timerDisplay.textContent = msToHMS(elapsed);
  }

  function renderLog(){
    const sessions = loadSessions();
    logTableBody.innerHTML = '';
    sessions.slice().reverse().forEach(s=>{
      const tr = document.createElement('tr');
      const tdTask = document.createElement('td'); tdTask.textContent = s.task || '(untitled)';
      const tdDur = document.createElement('td'); tdDur.textContent = msToHMS(s.duration);
      const tdDate = document.createElement('td'); const d = new Date(s.start);
      tdDate.textContent = `${d.toLocaleDateString()} ${d.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;
      tr.appendChild(tdTask); tr.appendChild(tdDur); tr.appendChild(tdDate);
      logTableBody.appendChild(tr);
    });
    renderTodaySum();
  }

  function renderStatus(){
    statusText.textContent = running ? 'running' : (accMs>0 ? 'paused' : 'stopped');
    startBtn.disabled = running;
    pauseBtn.disabled = !running;
    stopBtn.disabled = (!running && accMs===0);
    resetBtn.disabled = (running || accMs===0);
  }

  function renderTodaySum(){
    const sessions = loadSessions();
    const today = todayISO();
    const total = sessions.reduce((acc,s)=>{
      const sDate = new Date(s.start);
      return (todayISO(sDate) === today) ? acc + s.duration : acc;
    },0);
    todaySumEl.textContent = msToHMS(total);
  }

  // actions
  function startTimer(){
    if(running) return;
    running = true; startTs = Date.now();
    tickInterval = setInterval(renderTimerDisplay, 250);
    renderTimerDisplay(); renderStatus();
  }
  function pauseTimer(){
    if(!running) return;
    accMs += Date.now() - startTs; startTs = null; running = false;
    clearInterval(tickInterval); renderTimerDisplay(); renderStatus();
  }
  function resetTimer(){
    if(!confirm('Resetować licznik?')) return;
    running = false; startTs = null; accMs = 0; clearInterval(tickInterval);
    renderTimerDisplay(); renderStatus();
  }
  function stopAndSave(){
    if(running){ accMs += Date.now() - startTs; running = false; startTs = null; clearInterval(tickInterval); }
    const duration = accMs;
    if(duration <= 0){ renderTimerDisplay(); renderStatus(); return; }
    const task = taskNameInput.value.trim() || '(untitled)';
    const start = Date.now() - duration;
    const session = { task, start, duration };
    const sessions = loadSessions(); sessions.push(session); saveSessions(sessions);
    accMs = 0; renderLog(); renderTimerDisplay(); renderStatus();
  }

  function exportCSV(){
    const sessions = loadSessions();
    if(!sessions.length){ alert('Brak sesji do eksportu.'); return; }
    const header = ['task','start_iso','duration_seconds'];
    const rows = sessions.map(s=>[ `"${(s.task||'').replace(/"/g,'""')}"`, new Date(s.start).toISOString(), Math.round(s.duration/1000) ]);
    const csv = [header.join(','), ...rows.map(r=>r.join(','))].join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = `work_sessions_${new Date().toISOString().slice(0,10)}.csv`;
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  function clearLog(){
    if(!confirm('Usunąć wszystkie zapisane sesje?')) return;
    localStorage.removeItem(storageKey); renderLog();
  }

  // events
  startBtn.addEventListener('click', startTimer);
  pauseBtn.addEventListener('click', pauseTimer);
  resetBtn.addEventListener('click', resetTimer);
  stopBtn.addEventListener('click', ()=>{ if(confirm('Zatrzymać i zapisać sesję?')) stopAndSave(); });
  exportBtn.addEventListener('click', exportCSV);
  clearBtn.addEventListener('click', clearLog);

  document.addEventListener('keydown', (e)=>{
    if(e.target.tagName === 'INPUT') return;
    if(e.code === 'Space'){ e.preventDefault(); running ? pauseTimer() : startTimer(); }
    if(e.code === 'Enter'){ e.preventDefault(); stopAndSave(); }
  });

  // init
  renderLog(); renderTimerDisplay(); renderStatus();
</script>
</body>
</html>
